var QRReader={};function setPhotoSourceToScan(e){!e&&window.isMediaStreamAPISupported?QRReader.webcam=document.querySelector("video"):QRReader.webcam=document.querySelector("img")}QRReader.active=!1,QRReader.webcam=null,QRReader.canvas=null,QRReader.ctx=null,QRReader.decoder=null,QRReader.setCanvas=()=>{QRReader.canvas=document.createElement("canvas"),QRReader.ctx=QRReader.canvas.getContext("2d")},QRReader.init=()=>{var e="",a=!1;function r(){QRReader.canvas.width=window.innerWidth,QRReader.canvas.height=window.innerHeight}function t(e){navigator.mediaDevices.getUserMedia(e).then(function(e){QRReader.webcam.srcObject=e,QRReader.webcam.setAttribute("playsinline",!0),QRReader.webcam.setAttribute("controls",!0),setTimeout(()=>{document.querySelector("video").removeAttribute("controls")})}).catch(function(e){console.log("Error occurred ",e),d()})}function d(){window.noCameraPermission=!0,document.querySelector(".custom-scanner").style.display="none",snackbar.show("Unable to access the camera",1e4)}setPhotoSourceToScan(),QRReader.setCanvas(),QRReader.decoder=new Worker(e+"decoder.js"),window.isMediaStreamAPISupported?QRReader.webcam.addEventListener("play",function(e){a||(r(),a=!0)},!1):r(),window.isMediaStreamAPISupported&&navigator.mediaDevices.enumerateDevices().then(function(e){var a,r=e.filter(function(e){if(e.label.split(",")[1],"videoinput"==e.kind)return e});r.length>1?(a={video:{mandatory:{sourceId:r[r.length-1].deviceId?r[r.length-1].deviceId:null}},audio:!1},window.iOS&&(a.video.facingMode="environment"),t(a)):r.length?(a={video:{mandatory:{sourceId:r[0].deviceId?r[0].deviceId:null}},audio:!1},window.iOS&&(a.video.facingMode="environment"),a.video.mandatory.sourceId||window.iOS?t(a):t({video:!0})):t({video:!0})}).catch(function(e){d(),console.error("Error occurred : ",e)})},QRReader.scan=function(e,a){function r(){if(QRReader.active)try{QRReader.ctx.drawImage(QRReader.webcam,0,0,QRReader.canvas.width,QRReader.canvas.height);var e=QRReader.ctx.getImageData(0,0,QRReader.canvas.width,QRReader.canvas.height);e.data&&QRReader.decoder.postMessage(e)}catch(a){"NS_ERROR_NOT_AVAILABLE"==a.name&&setTimeout(r,0)}}QRReader.active=!0,QRReader.setCanvas(),QRReader.decoder.onmessage=function a(t){if(t.data.length>0){var d=t.data[0][2];QRReader.active=!1,e(d)}setTimeout(r,0)},setTimeout(()=>{setPhotoSourceToScan(a)}),r()};export default QRReader;
